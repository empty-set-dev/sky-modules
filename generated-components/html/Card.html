<div data-el="div-1">
  <template data-el="show"><img data-el="img-1" /></template>
  <template data-el="show-2">
    <h3 data-el="h3-1">
      <template data-el="div-2"><!-- props.title --></template>
    </h3>
  </template>
  <template data-el="show-3">
    <p data-el="p-1">
      <template data-el="div-3"><!-- props.subtitle --></template>
    </p>
  </template>
  <template data-el="show-4">
    <div><slot></slot></div>
  </template>
</div>
<script>
  (() => {
    const state = {
      isHovered: false,
      handleMouseEnter() {
        if (props.hoverable) {
          state.isHovered = true;
          update();
        }
      },
      handleMouseLeave() {
        if (props.hoverable) {
          state.isHovered = false;
          update();
        }
      },
    };
    let props = {};
    let context = null;
    let nodesToDestroy = [];
    let pendingUpdate = false;

    function destroyAnyNodes() {
      // destroy current view template refs before rendering again
      nodesToDestroy.forEach((el) => el.remove());
      nodesToDestroy = [];
    }

    // Function to update data bindings and loops
    // call update() when you mutate state and need the updates to reflect
    // in the dom
    function update() {
      if (pendingUpdate === true) {
        return;
      }
      pendingUpdate = true;

      document.querySelectorAll("[data-el='div-1']").forEach((el) => {
        Object.assign(el.style, cardStyle);
        el.removeEventListener("mouseenter", onDiv1Mouseenter);
        el.addEventListener("mouseenter", onDiv1Mouseenter);

        el.removeEventListener("mouseleave", onDiv1Mouseleave);
        el.addEventListener("mouseleave", onDiv1Mouseleave);

        el.removeEventListener("click", onDiv1Click);
        el.addEventListener("click", onDiv1Click);

        el.className = props.className;
      });

      document.querySelectorAll("[data-el='show']").forEach((el) => {
        const whenCondition = props.image;
        if (whenCondition) {
          showContent(el);
        }
      });

      document.querySelectorAll("[data-el='img-1']").forEach((el) => {
        el.setAttribute("src", props.image);

        el.setAttribute("alt", props.title || "Card image");

        Object.assign(el.style, imageStyle);
      });

      document.querySelectorAll("[data-el='show-2']").forEach((el) => {
        const whenCondition = props.title;
        if (whenCondition) {
          showContent(el);
        }
      });

      document.querySelectorAll("[data-el='h3-1']").forEach((el) => {
        Object.assign(el.style, titleStyle);
      });

      document.querySelectorAll("[data-el='div-2']").forEach((el) => {
        renderTextNode(el, props.title);
      });

      document.querySelectorAll("[data-el='show-3']").forEach((el) => {
        const whenCondition = props.subtitle;
        if (whenCondition) {
          showContent(el);
        }
      });

      document.querySelectorAll("[data-el='p-1']").forEach((el) => {
        Object.assign(el.style, subtitleStyle);
      });

      document.querySelectorAll("[data-el='div-3']").forEach((el) => {
        renderTextNode(el, props.subtitle);
      });

      document.querySelectorAll("[data-el='show-4']").forEach((el) => {
        const whenCondition = props.children;
        if (whenCondition) {
          showContent(el);
        }
      });

      destroyAnyNodes();

      pendingUpdate = false;
    }

    // Event handler for 'mouseenter' event on div-1
    function onDiv1Mouseenter(event) {
      state.handleMouseEnter();
    }

    // Event handler for 'mouseleave' event on div-1
    function onDiv1Mouseleave(event) {
      state.handleMouseLeave();
    }

    // Event handler for 'click' event on div-1
    function onDiv1Click(event) {
      props.onClick();
    }

    // Update with initial state on first load
    update();

    function showContent(el) {
      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLTemplateElement/content
      // grabs the content of a node that is between <template> tags
      // iterates through child nodes to register all content including text elements
      // attaches the content after the template

      const elementFragment = el.content.cloneNode(true);
      const children = Array.from(elementFragment.childNodes);
      children.forEach((child) => {
        if (el?.scope) {
          child.scope = el.scope;
        }
        if (el?.context) {
          child.context = el.context;
        }
        nodesToDestroy.push(child);
      });
      el.after(elementFragment);
    }

    // Helper text DOM nodes
    function renderTextNode(el, text) {
      const textNode = document.createTextNode(text);
      if (el?.scope) {
        textNode.scope = el.scope;
      }
      if (el?.context) {
        child.context = el.context;
      }
      el.after(textNode);
      nodesToDestroy.push(el.nextSibling);
    }
  })();
</script>
