<button data-el="button-1">
  <template data-el="show"><span>Loading...</span></template>
</button>
<script>
  (() => {
    const state = {
      isPressed: false,
      handleMouseDown() {
        state.isPressed = true;
        update();
      },
      handleMouseUp() {
        state.isPressed = false;
        update();
      },
    };
    let props = {};
    let context = null;
    let nodesToDestroy = [];
    let pendingUpdate = false;

    function destroyAnyNodes() {
      // destroy current view template refs before rendering again
      nodesToDestroy.forEach((el) => el.remove());
      nodesToDestroy = [];
    }

    // Function to update data bindings and loops
    // call update() when you mutate state and need the updates to reflect
    // in the dom
    function update() {
      if (pendingUpdate === true) {
        return;
      }
      pendingUpdate = true;

      document.querySelectorAll("[data-el='button-1']").forEach((el) => {
        Object.assign(el.style, getButtonStyle());
        el.removeEventListener("click", onButton1Click);
        el.addEventListener("click", onButton1Click);

        el.removeEventListener("mousedown", onButton1Mousedown);
        el.addEventListener("mousedown", onButton1Mousedown);

        el.removeEventListener("mouseup", onButton1Mouseup);
        el.addEventListener("mouseup", onButton1Mouseup);

        el.setAttribute("disabled", props.disabled);
      });

      document.querySelectorAll("[data-el='show']").forEach((el) => {
        const whenCondition = props.loading;
        if (whenCondition) {
          showContent(el);
        }
      });

      destroyAnyNodes();

      pendingUpdate = false;
    }

    // Event handler for 'click' event on button-1
    function onButton1Click(event) {
      (props.disabled ? undefined : props.onClick)();
    }

    // Event handler for 'mousedown' event on button-1
    function onButton1Mousedown(event) {
      state.handleMouseDown();
    }

    // Event handler for 'mouseup' event on button-1
    function onButton1Mouseup(event) {
      state.handleMouseUp();
    }

    // Update with initial state on first load
    update();

    function showContent(el) {
      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLTemplateElement/content
      // grabs the content of a node that is between <template> tags
      // iterates through child nodes to register all content including text elements
      // attaches the content after the template

      const elementFragment = el.content.cloneNode(true);
      const children = Array.from(elementFragment.childNodes);
      children.forEach((child) => {
        if (el?.scope) {
          child.scope = el.scope;
        }
        if (el?.context) {
          child.context = el.context;
        }
        nodesToDestroy.push(child);
      });
      el.after(elementFragment);
    }

    // Helper text DOM nodes
    function renderTextNode(el, text) {
      const textNode = document.createTextNode(text);
      if (el?.scope) {
        textNode.scope = el.scope;
      }
      if (el?.context) {
        child.context = el.context;
      }
      el.after(textNode);
      nodesToDestroy.push(el.nextSibling);
    }
  })();
</script>
