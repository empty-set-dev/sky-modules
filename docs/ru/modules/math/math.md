# math

<div class="sky-gradient-text" style="font-size: 1.2em; margin: 1em 0;">
  Math utility module
</div>

Математические утилиты и операции с векторами для 2D/3D графики и научных вычислений.

## Установка

```bash
npm install @sky-modules/math
```

## Возможности

- **Vector2** - класс 2D векторов с математическими операциями (из Three.js)
- **Vector3** - класс 3D векторов с математическими операциями (из Three.js)
- **Математические типы Three.js** - полные TypeScript определения для математической библиотеки Three.js
- **Глобальные расширения** - опциональное добавление в глобальное пространство имен для удобства
- **Нет зависимостей** - реэкспорты из Three.js math без дополнительных накладных расходов

## Использование

### Базовые операции с векторами

```typescript
import { Vector2, Vector3 } from '@sky-modules/math'

// 2D векторы
const v2 = new Vector2(10, 20)
const v2_copy = v2.clone()
v2_copy.add(new Vector2(5, 5)) // (15, 25)

// 3D векторы
const v3 = new Vector3(1, 2, 3)
const length = v3.length() // ~3.74
const normalized = v3.clone().normalize() // Единичный вектор
```

### Математика векторов

```typescript
import { Vector3 } from '@sky-modules/math'

const v1 = new Vector3(1, 0, 0)
const v2 = new Vector3(0, 1, 0)

// Скалярное произведение
const dot = v1.dot(v2) // 0

// Векторное произведение
const cross = v1.clone().cross(v2) // (0, 0, 1)

// Расстояние между векторами
const distance = v1.distanceTo(v2) // ~1.41

// Линейная интерполяция
const lerp = v1.clone().lerp(v2, 0.5) // (0.5, 0.5, 0)
```

### Глобальные расширения

```typescript
// Импортируйте глобальные расширения для использования без импортов
import '@sky-modules/math/global'

// Теперь Vector2 и Vector3 доступны глобально
const vec = new Vector2(10, 20)
const vec3 = new Vector3(1, 2, 3)
```

### Математические типы Three.js

Модуль включает полные TypeScript определения для всех математических классов Three.js:

```typescript
import type {
    Box2,
    Box3,
    Color,
    Euler,
    Matrix3,
    Matrix4,
    Quaternion,
    Sphere,
    Plane,
    Ray,
    // ... и другие
} from '@sky-modules/math/three'
```

## API

### Vector2

**Источник:** `@sky-modules/math/three/Vector2`

**Основные методы:**
- `new Vector2(x?, y?)` - Создать 2D вектор
- `add(v)` - Сложить с вектором
- `sub(v)` - Вычесть вектор
- `multiply(v)` - Умножить на вектор
- `multiplyScalar(s)` - Умножить на скаляр
- `divide(v)` - Разделить на вектор
- `divideScalar(s)` - Разделить на скаляр
- `dot(v)` - Скалярное произведение
- `cross(v)` - Векторное произведение (возвращает скаляр)
- `length()` - Длина вектора
- `lengthSq()` - Квадрат длины (быстрее)
- `normalize()` - Преобразовать в единичный вектор
- `distanceTo(v)` - Расстояние до другого вектора
- `distanceToSquared(v)` - Квадрат расстояния (быстрее)
- `lerp(v, alpha)` - Линейная интерполяция
- `clone()` - Создать копию
- `equals(v)` - Проверка равенства

### Vector3

**Источник:** `@sky-modules/math/three/Vector3`

**Основные методы:**
- `new Vector3(x?, y?, z?)` - Создать 3D вектор
- `add(v)` - Сложить с вектором
- `sub(v)` - Вычесть вектор
- `multiply(v)` - Умножить на вектор
- `multiplyScalar(s)` - Умножить на скаляр
- `divide(v)` - Разделить на вектор
- `divideScalar(s)` - Разделить на скаляр
- `dot(v)` - Скалярное произведение
- `cross(v)` - Векторное произведение (возвращает вектор)
- `length()` - Длина вектора
- `lengthSq()` - Квадрат длины (быстрее)
- `normalize()` - Преобразовать в единичный вектор
- `distanceTo(v)` - Расстояние до другого вектора
- `distanceToSquared(v)` - Квадрат расстояния (быстрее)
- `lerp(v, alpha)` - Линейная интерполяция
- `applyMatrix3(m)` - Применить трансформацию матрицы 3x3
- `applyMatrix4(m)` - Применить трансформацию матрицы 4x4
- `applyQuaternion(q)` - Применить вращение кватерниона
- `clone()` - Создать копию
- `equals(v)` - Проверка равенства

## Файлы

### Vector2/index.ts
**Назначение:** Реэкспорт Vector2 из математической библиотеки Three.js
**Экспорты:** `Vector2` (экспорт по умолчанию)

### Vector2/global/Vector2.ts
**Назначение:** Расширение глобального пространства имен для Vector2
**Особенности:**
- Делает Vector2 доступным глобально без импортов
- Использует утилиту globalify для безопасной регистрации в глобальном пространстве

### Vector3/index.ts
**Назначение:** Реэкспорт Vector3 из математической библиотеки Three.js
**Экспорты:** `Vector3` (экспорт по умолчанию)

### Vector3/global/Vector3.ts
**Назначение:** Расширение глобального пространства имен для Vector3
**Особенности:**
- Делает Vector3 доступным глобально без импортов
- Использует утилиту globalify для безопасной регистрации в глобальном пространстве

### three/*.d.ts
**Назначение:** TypeScript определения типов для математических классов Three.js
**Основные экспорты:**
- `Box2`, `Box3` - Ограничивающие параллелепипеды, выровненные по осям
- `Color` - RGB цвет с утилитами конвертации
- `Euler` - Вращение углами Эйлера
- `Matrix2`, `Matrix3`, `Matrix4` - Матричные трансформации
- `Quaternion` - Вращение кватернионом
- `Sphere`, `Spherical` - Сферические координаты и фигуры
- `Plane` - Бесконечная плоскость
- `Ray` - Луч для рейкастинга
- `Triangle` - Геометрия треугольника
- `MathUtils` - Вспомогательные математические функции
- И другие...

## Связанные модули

- [@sky-modules/three](/three) - 3D рендеринг Three.js с поддержкой JSX
- [@sky-modules/canvas](/canvas) - 2D рендеринг canvas с поддержкой векторов

## Примечания по реализации

### Архитектура

Модуль является тонкой обёрткой над математической библиотекой Three.js:
1. **Vector2/Vector3** - прямые реэкспорты из `three/src/math/`
2. **Определения типов** обеспечивают полную поддержку TypeScript
3. **Глобальные расширения** используют утилиту `globalify` для безопасного добавления в пространство имен
4. **Нулевые накладные расходы** - никаких дополнительных абстракций или преобразований

### Почему математика Three.js?

Математические классы Three.js:
- Проверены в продакшн 3D приложениях
- Высоко оптимизированы для производительности
- Функционально полные с обширным набором операций
- Хорошо документированы и поддерживаются
- Совместимы с WebGL и Canvas API

### Структура модуля

```
math/
├── Vector2/
│   ├── index.ts              # Реэкспорт из three
│   └── global/
│       ├── Vector2.ts        # Глобальное расширение
│       └── index.ts
├── Vector3/
│   ├── index.ts              # Реэкспорт из three
│   └── global/
│       ├── Vector3.ts        # Глобальное расширение
│       └── index.ts
├── three/
│   ├── Vector2.d.ts          # Определения типов
│   ├── Vector3.d.ts
│   └── ...                   # Другие математические типы
├── global/
│   └── index.ts              # Все глобальные расширения
└── index.ts                  # Главная точка входа
```

### Соображения производительности

1. **Используйте `lengthSq()` и `distanceToSquared()` когда возможно** - Избегает дорогой операции sqrt()
2. **Переиспользуйте векторы** - Используйте `set()`, `copy()` или модифицируйте на месте чтобы избежать аллокаций
3. **Нормализуйте экономно** - Нормализация включает деление на длину (sqrt + деление)
4. **Объединяйте операции в цепочки** - Методы возвращают `this` для текучего API

### Лучшие практики

```typescript
// Хорошо - переиспользование векторов
const temp = new Vector3()
for (const point of points) {
    temp.copy(point).normalize()
    // используйте temp...
}

// Плохо - создание множества векторов
for (const point of points) {
    const normalized = point.clone().normalize()
    // используйте normalized...
}

// Хорошо - используйте квадрат расстояния
if (v1.distanceToSquared(v2) < threshold * threshold) {
    // ...
}

// Плохо - ненужный sqrt
if (v1.distanceTo(v2) < threshold) {
    // ...
}
```
